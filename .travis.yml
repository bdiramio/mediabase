dist: trusty
sudo: false
notifications:
  email: false
env:
- RELEASE_TAG="release-$TRAVIS_BUILD_NUMBER"
if: tag IS blank

jobs:
  include:
  - stage: build and release to github
    language: java
    jdk: oraclejdk8
    install: skip
    script: ./gradlew clean build -x test
    before_deploy:
    - git config --local user.name "Build Bot"
    - git config --local user.email "buildbot@example.com"
    - git tag -f $RELEASE_TAG
    deploy:
      provider: releases
      api_key: 20b059af4935dac29d6ea87cc88bed99c6437e3c
      file: "build/libs/mediabase-1.0-SNAPSHOT.war"
      skip_cleanup: true
  - stage: deploy to test
    language: java
    script:
    - echo "Downloading $RELEASE_TAG"
    - wget -P build/libs https://github.com/$GITHUB_USERNAME/mediabase/releases/download/$RELEASE_TAG/mediabase-1.0-SNAPSHOT.war
    before_deploy:
    - echo "Deploying $RELEASE_TAG to test"
    deploy:
      provider: cloudfoundry
      api: api.sys.pcf.paltraining.perficient.com
      username: Bobd@Well-B.com
      password: cQmHURYj
      organization: Bobd
      space: test
